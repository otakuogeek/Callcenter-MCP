# ‚ö° Quick Start - Acciones Inmediatas

**Duraci√≥n:** 8 horas (1 d√≠a de trabajo)  
**Dificultad:** Muy F√°cil ‚úÖ  
**Riesgo:** Muy Bajo ‚úÖ  
**Impacto:** Muy Alto üöÄ

---

## üéØ Objetivo del D√≠a

Implementar 3 cambios fundamentales que mejoren la calidad del c√≥digo sin romper nada.

```
8:00  - Crear logger.ts ................................. 1h
9:00  - Crear errorHandler.ts ........................... 1h
10:00 - Crear AvailabilityContext.tsx .................. 1h
11:00 - Break .......................................... 15min
11:15 - Reemplazar 20 console.log ...................... 2h
13:15 - Lunch ........................................... 45min
14:00 - Testing en 2 componentes ........................ 1.5h
15:30 - Documentar cambios .............................. 1h
16:30 - End
```

---

## Tarea 1: Logger (1 hora)

### üöÄ Comenzar

```bash
# 1. Crear archivo
touch src/lib/logger.ts

# 2. Copiar c√≥digo (abajo)
# 3. Testear en un componente
```

### üíª C√≥digo Completo

```typescript
// src/lib/logger.ts
type LogLevel = 'debug' | 'info' | 'warn' | 'error';

class Logger {
  private isDev = import.meta.env.DEV;

  private log(level: LogLevel, message: string, data?: any) {
    if (!this.isDev) return;

    const prefix = `[${level.toUpperCase()}]`;
    const colors = {
      debug: '#999',
      info: '#0099ff',
      warn: '#ff9900',
      error: '#ff0000',
    };

    console.log(
      `%c${prefix} ${message}`,
      `color: ${colors[level]}; font-weight: bold;`,
      data || ''
    );
  }

  debug(msg: string, data?: any) { this.log('debug', msg, data); }
  info(msg: string, data?: any) { this.log('info', msg, data); }
  warn(msg: string, data?: any) { this.log('warn', msg, data); }
  error(msg: string, err?: any) { this.log('error', msg, err?.message); }
}

export const logger = new Logger();
```

### ‚úÖ Verificar

```typescript
// En cualquier componente
import { logger } from '@/lib/logger';

logger.info('Component loaded');
logger.warn('This is a warning');
logger.error('Error happened', new Error('Test'));

// Resultado en DevTools: Colorido y ordenado ‚úÖ
```

---

## Tarea 2: Error Handler (1 hora)

### üöÄ Comenzar

```bash
touch src/lib/errorHandler.ts
```

### üíª C√≥digo Completo

```typescript
// src/lib/errorHandler.ts
export class AppError extends Error {
  constructor(
    public message: string,
    public code: string = 'UNKNOWN_ERROR',
    public statusCode?: number
  ) {
    super(message);
    this.name = 'AppError';
  }
}

export function getErrorMessage(error: any): string {
  // HTTP status errors
  const statusMessages: Record<number, string> = {
    400: 'Los datos no son v√°lidos',
    401: 'Tu sesi√≥n ha expirado',
    403: 'No tienes permiso',
    404: 'No encontrado',
    409: 'Ya existe',
    500: 'Error del servidor',
    503: 'Servicio no disponible',
  };

  if (error?.response?.status in statusMessages) {
    return statusMessages[error.response.status];
  }

  // Errores de conexi√≥n
  if (error?.message?.includes('network') || error?.code === 'NETWORK_ERROR') {
    return 'Error de conexi√≥n, verifica tu internet';
  }

  // Errores de validaci√≥n
  if (error?.code === 'VALIDATION_ERROR') {
    return 'Datos inv√°lidos: ' + error.message;
  }

  // Default
  return error?.message || 'Algo sali√≥ mal, intenta de nuevo';
}

export function isRetryableError(error: any): boolean {
  const retryable = [408, 429, 500, 502, 503, 504];
  return retryable.includes(error?.response?.status);
}
```

### ‚úÖ Verificar

```typescript
import { getErrorMessage } from '@/lib/errorHandler';

try {
  throw new Error('Test error');
} catch (error) {
  const msg = getErrorMessage(error);
  console.log(msg); // "Algo sali√≥ mal, intenta de nuevo" ‚úÖ
}
```

---

## Tarea 3: Context API (1 hora)

### üöÄ Comenzar

```bash
mkdir -p src/context
touch src/context/AvailabilityContext.tsx
```

### üíª C√≥digo Completo (Versi√≥n Simple)

```typescript
// src/context/AvailabilityContext.tsx
import { createContext, useContext, useState, ReactNode } from 'react';

interface AvailabilityContextType {
  selectedId: number | null;
  setSelectedId: (id: number | null) => void;
}

const AvailabilityContext = createContext<AvailabilityContextType | undefined>(undefined);

export function AvailabilityProvider({ children }: { children: ReactNode }) {
  const [selectedId, setSelectedId] = useState<number | null>(null);

  return (
    <AvailabilityContext.Provider value={{ selectedId, setSelectedId }}>
      {children}
    </AvailabilityContext.Provider>
  );
}

export function useAvailability() {
  const context = useContext(AvailabilityContext);
  if (!context) {
    throw new Error('useAvailability debe usarse dentro de AvailabilityProvider');
  }
  return context;
}
```

### üîß Usar en App.tsx

```typescript
// src/App.tsx
import { AvailabilityProvider } from '@/context/AvailabilityContext';

export const App = () => (
  <QueryClientProvider client={queryClient}>
    <AvailabilityProvider>  {/* ‚Üê AGREGAR AQU√ç */}
      <TooltipProvider>
        {/* ... resto del c√≥digo ... */}
      </TooltipProvider>
    </AvailabilityProvider>
  </QueryClientProvider>
);
```

### ‚úÖ Verificar

```typescript
// En componentes
import { useAvailability } from '@/context/AvailabilityContext';

function MyComponent() {
  const { selectedId, setSelectedId } = useAvailability();

  return (
    <div>
      <p>Selected: {selectedId}</p>
      <button onClick={() => setSelectedId(123)}>Select 123</button>
    </div>
  );
}
```

---

## Tarea 4: Reemplazar Console.log (2 horas)

### üìã Top 20 Console.log a Reemplazar

```bash
# En: src/components/AvailabilityList.tsx
L√≠nea 94:   console.log("Disponibilidad actualizada...")
L√≠nea 161:  console.log('Disponibilidad seleccionada...')
L√≠nea 162:  console.log('Total de citas obtenidas...')
L√≠nea 163:  console.log('Ejemplo de cita completa...')
L√≠nea 179:  console.log(`Cita ${apt.id}...`)
L√≠nea 184:  console.log('Citas filtradas para el doctor...')
L√≠nea 218:  console.log('Datos para PDF...')

# En: src/components/TransferAvailabilityModal.tsx
L√≠nea 47:   console.log("Generando notificaci√≥n...")
L√≠nea 112:  console.log("Llamando a pacientes...")
L√≠nea 170:  console.log("Transfiriendo disponibilidad...")

# ... y 10 m√°s en otros componentes
```

### üîß Patr√≥n de Reemplazo

```typescript
// ‚ùå ANTES
import { useState } from 'react';

function MyComponent() {
  const handleUpdate = async (id) => {
    console.log("Actualizando:", id, updates);
    await updateAvailability(id, updates);
    console.log("Actualizado exitosamente:", id, updates);
  };
}

// ‚úÖ DESPU√âS
import { useState } from 'react';
import { logger } from '@/lib/logger';

function MyComponent() {
  const handleUpdate = async (id) => {
    logger.info('Updating availability', { id }); // Sin datos sensibles
    await updateAvailability(id, updates);
    logger.info('Availability updated', { id });
  };
}
```

### ‚è±Ô∏è Checklist R√°pido

```bash
‚ñ° AvailabilityList.tsx ................ (15 logs)
‚ñ° TransferAvailabilityModal.tsx ....... (10 logs)
‚ñ° AppointmentDistributionModal.tsx ... (8 logs)
‚ñ° EPSAuthorizationsManagement.tsx .... (6 logs)
‚ñ° CupsManagement.tsx ................. (5 logs)

Total: 44 logs reemplazados = ‚úÖ
```

---

## Tarea 5: Testing de Cambios (1.5 horas)

### üß™ Test 1: Logger Funciona

```typescript
// En DevTools (F12)
// 1. Abrir Console
// 2. Ir a src/components/AvailabilityList.tsx
// 3. Hacer clic en "Ver" de una disponibilidad
// 4. Verificar en Console:
//    [INFO] Availability selected {id: 123}
//    [DEBUG] Appointments loaded {count: 45}

‚úÖ √âxito si ves logs coloridos
```

### üß™ Test 2: Error Handler Funciona

```typescript
// En tu componente
import { getErrorMessage } from '@/lib/errorHandler';

// Simular error
try {
  throw { response: { status: 401 } };
} catch (error) {
  const msg = getErrorMessage(error);
  console.log(msg); // "Tu sesi√≥n ha expirado" ‚úÖ
}
```

### üß™ Test 3: Context API Funciona

```typescript
// 1. Verificar que App.tsx envuelve con AvailabilityProvider
// 2. En cualquier componente dentro de App:
import { useAvailability } from '@/context/AvailabilityContext';

function TestComponent() {
  const { selectedId, setSelectedId } = useAvailability();
  
  return (
    <div>
      <button onClick={() => setSelectedId(999)}>Test</button>
      <p>ID: {selectedId}</p>
    </div>
  );
}

// 3. Click en el bot√≥n
// 4. Verificar que se actualiza ‚úÖ
```

### üß™ Test 4: Compilaci√≥n

```bash
cd /home/ubuntu/app/frontend
npm run build

# Resultado esperado:
# ‚úì built in 15-20s
# Sin errores TypeScript ‚úÖ
```

---

## üìù Documentar Cambios

### Crear archivo de cambios

```bash
touch /home/ubuntu/app/docs/CAMBIOS_DIA_1.md
```

### Contenido

```markdown
# Cambios Implementados - D√≠a 1

## 1. Logger Centralizado
- **Archivo:** src/lib/logger.ts
- **Uso:** Reemplaza console.log en 44 componentes
- **Beneficio:** Limpieza, seguridad, debugging

## 2. Error Handler Centralizado  
- **Archivo:** src/lib/errorHandler.ts
- **Uso:** Mensajes de error consistentes
- **Beneficio:** Mejor UX, mensajes espec√≠ficos

## 3. Context API B√°sico
- **Archivo:** src/context/AvailabilityContext.tsx
- **Uso:** Estado compartido sin prop drilling
- **Beneficio:** Mejor performance, c√≥digo limpio

## 4. Reemplazo de Console.log
- **Cantidad:** 44 reemplazos en 5 componentes
- **Patr√≥n:** logger.info/debug en lugar de console.log
- **Beneficio:** DevTools limpio, no expone datos

## Pr√≥ximos Pasos
1. Completar logger en ALL componentes (20 m√°s)
2. Implementar validaci√≥n Zod
3. Comenzar refactorizaci√≥n de componentes grandes
```

---

## ‚úÖ Checklist Final

```
ANTES DE TERMINAR:

‚ñ° logger.ts creado y funciona
‚ñ° errorHandler.ts creado y funciona
‚ñ° AvailabilityContext.tsx creado y funciona
‚ñ° App.tsx envuelto en AvailabilityProvider
‚ñ° 44 console.log reemplazados
‚ñ° npm run build exitoso
‚ñ° Sin errores TypeScript
‚ñ° Tests b√°sicos pasados
‚ñ° Documentaci√≥n creada
‚ñ° C√≥digo committeado

SI TODO ‚úÖ: ¬°LISTO PARA MA√ëANA!
```

---

## üöÄ Pr√≥ximo D√≠a

Despu√©s de completar todo hoy:

```
Ma√±ana (D√≠a 2):
‚îú‚îÄ Reemplazar 20 console.log m√°s
‚îú‚îÄ Refactorizar AvailabilityList (separar en subcomponentes)
‚îú‚îÄ Crear useAvailabilityData hook
‚îî‚îÄ Testing de cambios

Resultados esperados:
‚îú‚îÄ C√≥digo 30% m√°s limpio
‚îú‚îÄ DevTools sin contaminaci√≥n
‚îú‚îÄ Prop drilling eliminado
‚îî‚îÄ Base s√≥lida para Fase 2
```

---

## üìû Si algo falla

### Error: "useAvailability debe usarse dentro de AvailabilityProvider"

**Soluci√≥n:**
```typescript
// Aseg√∫rate de que en App.tsx est√©:
<AvailabilityProvider>
  <TooltipProvider>
    {/* Routes here */}
  </TooltipProvider>
</AvailabilityProvider>
```

### Error: "Logger is not defined"

**Soluci√≥n:**
```typescript
// Aseg√∫rate de importar:
import { logger } from '@/lib/logger';
```

### Error de compilaci√≥n TypeScript

**Soluci√≥n:**
```bash
npm run build -- --verbose
# Leer el error espec√≠fico y arreglarlo
```

---

## üéâ √âxito = Resultados Visibles

```
Antes de hoy:
‚îú‚îÄ DevTools lleno de console.log
‚îú‚îÄ Mensajes de error inconsistentes
‚îú‚îÄ Prop drilling en toda la app
‚îî‚îÄ Dif√≠cil de debuggear

Despu√©s de hoy:
‚îú‚îÄ DevTools limpio y colorido
‚îú‚îÄ Mensajes de error claros
‚îú‚îÄ Context API implementada
‚îî‚îÄ F√°cil de debuggear

MEJORA: +40% en Developer Experience üöÄ
```

---

**¬°A Trabajar! El siguiente commit ser√° hist√≥rico.** üí™

Tiempo estimado: 8 horas  
Dificultad: ‚≠ê Muy F√°cil  
Impacto: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Muy Alto

**Let's Go! üöÄ**
